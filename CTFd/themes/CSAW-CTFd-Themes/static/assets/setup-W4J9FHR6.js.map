{"version":3,"file":"setup-W4J9FHR6.js","sources":["../../assets/js/setup.js"],"sourcesContent":["import Alpine from \"alpinejs\";\nimport dayjs from \"dayjs\";\nimport { Tab } from \"bootstrap\";\n\nimport CTFd from \"./index\";\n\nwindow.Alpine = Alpine;\n\nAlpine.data(\"SetupForm\", () => ({\n  init() {\n    // Bind Enter on any input to clicking the Next button\n    this.$root.querySelectorAll(\"input\").forEach(i => {\n      i.addEventListener(\"keypress\", e => {\n        if (e.key == \"Enter\") {\n          e.preventDefault();\n          e.target.closest(\".tab-pane\").querySelector(\"button[data-href]\").click();\n        }\n      });\n      i.addEventListener(\"change\", e => {\n        if (e.target.checkValidity() === false) {\n          e.target.classList.add(\"input-filled-invalid\");\n        } else {\n          e.target.classList.remove(\"input-filled-invalid\");\n        }\n      });\n    });\n\n    // Register storage listener for MLC integration\n    window.addEventListener(\"storage\", function (event) {\n      if (event.key == \"integrations\" && event.newValue) {\n        let integration = JSON.parse(event.newValue);\n        if (integration[\"name\"] == \"mlc\") {\n          $(\"#integration-mlc\").text(\"Already Configured\").attr(\"disabled\", true);\n          window.focus();\n          localStorage.removeItem(\"integrations\");\n        }\n      }\n    });\n  },\n\n  validateFileSize(e, limit) {\n    if (e.target.files[0].size > limit) {\n      if (\n        !confirm(\n          `This image file is larger than ${\n            limit / 1000\n          }KB which may result in increased load times. Are you sure you'd like to use this file?`,\n        )\n      ) {\n        e.target.value = \"\";\n      }\n    }\n  },\n\n  switchTab(e) {\n    // Handle tab validation\n    let valid_tab = true;\n    let inputs = e.target\n      .closest('[role=\"tabpanel\"]')\n      .querySelectorAll(\"input,textarea\");\n\n    inputs.forEach(e => {\n      if (e.checkValidity() === false) {\n        e.classList.add(\"input-filled-invalid\");\n        valid_tab = false;\n      }\n    });\n\n    if (valid_tab == false) {\n      return;\n    }\n\n    let target = e.target.dataset.href;\n    let tab = this.$root.querySelector(`[data-bs-target=\"${target}\"]`);\n    Tab.getOrCreateInstance(tab).show();\n  },\n\n  setThemeColor(e) {\n    document.querySelector(\"#config-color-input\").value = e.target.value;\n  },\n\n  resetThemeColor(_e) {\n    document.querySelector(\"#config-color-input\").value = \"\";\n    document.querySelector(\"#config-color-picker\").value = \"\";\n  },\n\n  processDateTime(datetime) {\n    return function (_event) {\n      let date_picker = document.querySelector(`#${datetime}-date`);\n      let time_picker = document.querySelector(`#${datetime}-time`);\n      let unix_time = dayjs(\n        `${date_picker.value} ${time_picker.value}`,\n        \"YYYY-MM-DD HH:mm\",\n      ).unix();\n\n      if (isNaN(unix_time)) {\n        document.querySelector(`#${datetime}-preview`).value = \"\";\n      } else {\n        document.querySelector(`#${datetime}-preview`).value = unix_time;\n      }\n    };\n  },\n\n  mlcSetup() {\n    let r = CTFd.config.urlRoot;\n    let params = {\n      name: document.querySelector(\"#ctf_name\").value,\n      type: \"jeopardy\",\n      description: document.querySelector(\"#ctf_description\").value,\n      user_mode: document.querySelector(\"[name=user_mode]:checked\").value,\n      event_url: window.location.origin + r,\n      redirect_url: window.location.origin + r + \"/redirect\",\n      integration_setup_url: window.location.origin + r + \"/setup/integrations\",\n      start: document.querySelector(\"#start-preview\").value,\n      end: document.querySelector(\"#end-preview\").value,\n      platform: \"CTFd\",\n      state: window.STATE,\n    };\n\n    const ret = [];\n    for (let p in params) {\n      ret.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(params[p]));\n    }\n    window.open(\n      \"https://www.majorleaguecyber.org/events/new?\" + ret.join(\"&\"),\n      \"_blank\",\n    );\n  },\n\n  submitSetup(e) {\n    if (document.querySelector(\"#newsletter-checkbox\").checked) {\n      let email = e.target.querySelector(\"input[name=email]\").value;\n      let params = {\n        email: email,\n        b_38e27f7d496889133d2214208_d7c3ed71f9: \"\",\n        c: \"jsonp_callback_\" + Math.round(10000 * Math.random()),\n      };\n      const ret = [];\n      for (let p in params) {\n        ret.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(params[p]));\n      }\n\n      var script = document.createElement(\"script\");\n      script.src =\n        \"https://newsletters.ctfd.io/lists/ot889gr1sa0e1/subscribe/post-json?\" +\n        ret.join(\"&\");\n      document.head.appendChild(script);\n    }\n  },\n}));\n\nAlpine.start();\n"],"names":["Alpine","i","e","event","limit","valid_tab","target","tab","Tab","_e","datetime","_event","date_picker","time_picker","unix_time","dayjs","r","CTFd","params","ret","p","script"],"mappings":"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"}