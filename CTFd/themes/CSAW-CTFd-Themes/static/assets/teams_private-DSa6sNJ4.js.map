{"version":3,"file":"teams_private-DSa6sNJ4.js","sources":["../../assets/js/teams/private.js"],"sourcesContent":["import Alpine from \"alpinejs\";\nimport CTFd from \"../index\";\nimport { Modal } from \"bootstrap\";\nimport { serializeJSON } from \"@ctfdio/ctfd-js/forms\";\nimport { copyToClipboard } from \"../utils/clipboard\";\nimport { colorHash } from \"@ctfdio/ctfd-js/ui\";\nimport { getOption as getUserScoreOption } from \"../utils/graphs/echarts/userscore\";\nimport { embed } from \"../utils/graphs/echarts\";\n\nwindow.Alpine = Alpine;\nwindow.CTFd = CTFd;\n\nAlpine.store(\"inviteToken\", \"\");\n\nAlpine.data(\"TeamEditModal\", () => ({\n  success: null,\n  error: null,\n  initial: null,\n  errors: [],\n\n  init() {\n    this.initial = serializeJSON(this.$el.querySelector(\"form\"));\n  },\n\n  async updateProfile() {\n    let data = serializeJSON(this.$el, this.initial, true);\n\n    data.fields = [];\n\n    for (const property in data) {\n      if (property.match(/fields\\[\\d+\\]/)) {\n        let field = {};\n        let id = parseInt(property.slice(7, -1));\n        field[\"field_id\"] = id;\n        field[\"value\"] = data[property];\n        data.fields.push(field);\n        delete data[property];\n      }\n    }\n\n    let response = await CTFd.pages.teams.updateTeamSettings(data);\n    if (response.success) {\n      this.success = true;\n      this.error = false;\n      setTimeout(() => {\n        this.success = null;\n        this.error = null;\n      }, 3000);\n    } else {\n      this.success = false;\n      this.error = true;\n      Object.keys(response.errors).map(error => {\n        const error_msg = response.errors[error];\n        this.errors.push(error_msg);\n      });\n    }\n  },\n}));\n\nAlpine.data(\"TeamCaptainModal\", () => ({\n  success: null,\n  error: null,\n  errors: [],\n\n  async updateCaptain() {\n    let data = serializeJSON(this.$el, null, true);\n    let response = await CTFd.pages.teams.updateTeamSettings(data);\n\n    if (response.success) {\n      window.location.reload();\n    } else {\n      this.success = false;\n      this.error = true;\n      Object.keys(response.errors).map(error => {\n        const error_msg = response.errors[error];\n        this.errors.push(error_msg);\n      });\n    }\n  },\n}));\n\nAlpine.data(\"TeamInviteModal\", () => ({\n  copy() {\n    copyToClipboard(this.$refs.link);\n  },\n}));\n\nAlpine.data(\"TeamDisbandModal\", () => ({\n  errors: [],\n\n  async disbandTeam() {\n    let response = await CTFd.pages.teams.disbandTeam();\n\n    if (response.success) {\n      window.location.reload();\n    } else {\n      this.errors = response.errors[\"\"];\n    }\n  },\n}));\n\nAlpine.data(\"CaptainMenu\", () => ({\n  captain: false,\n\n  editTeam() {\n    this.teamEditModal = new Modal(document.getElementById(\"team-edit-modal\"));\n    this.teamEditModal.show();\n  },\n\n  chooseCaptain() {\n    this.teamCaptainModal = new Modal(document.getElementById(\"team-captain-modal\"));\n    this.teamCaptainModal.show();\n  },\n\n  async inviteMembers() {\n    const response = await CTFd.pages.teams.getInviteToken();\n\n    if (response.success) {\n      const code = response.data.code;\n      const url = `${window.location.origin}${CTFd.config.urlRoot}/teams/invite?code=${code}`;\n\n      document.querySelector(\"#team-invite-modal input[name=link]\").value = url;\n      this.$store.inviteToken = url;\n      this.teamInviteModal = new Modal(document.getElementById(\"team-invite-modal\"));\n      this.teamInviteModal.show();\n    } else {\n      Object.keys(response.errors).map(error => {\n        const error_msg = response.errors[error];\n        alert(error_msg);\n      });\n    }\n  },\n\n  disbandTeam() {\n    this.teamDisbandModal = new Modal(document.getElementById(\"team-disband-modal\"));\n    this.teamDisbandModal.show();\n  },\n}));\n\nAlpine.data(\"TeamGraphs\", () => ({\n  solves: null,\n  fails: null,\n  awards: null,\n  solveCount: 0,\n  failCount: 0,\n  awardCount: 0,\n\n  getSolvePercentage() {\n    return ((this.solveCount / (this.solveCount + this.failCount)) * 100).toFixed(2);\n  },\n\n  getFailPercentage() {\n    return ((this.failCount / (this.solveCount + this.failCount)) * 100).toFixed(2);\n  },\n\n  getCategoryBreakdown() {\n    const categories = [];\n    const breakdown = {};\n\n    this.solves.data.map(solve => {\n      categories.push(solve.challenge.category);\n    });\n\n    categories.forEach(category => {\n      if (category in breakdown) {\n        breakdown[category] += 1;\n      } else {\n        breakdown[category] = 1;\n      }\n    });\n\n    const data = [];\n    for (const property in breakdown) {\n      data.push({\n        name: property,\n        count: breakdown[property],\n        percent: (breakdown[property] / categories.length) * 100,\n        color: colorHash(property),\n      });\n    }\n\n    return data;\n  },\n\n  async init() {\n    this.solves = await CTFd.pages.teams.teamSolves(\"me\");\n    this.fails = await CTFd.pages.teams.teamFails(\"me\");\n    this.awards = await CTFd.pages.teams.teamAwards(\"me\");\n\n    this.solveCount = this.solves.meta.count;\n    this.failCount = this.fails.meta.count;\n    this.awardCount = this.awards.meta.count;\n\n    embed(\n      this.$refs.scoregraph,\n      getUserScoreOption(\n        CTFd.team.id,\n        CTFd.team.name,\n        this.solves.data,\n        this.awards.data,\n      ),\n    );\n  },\n}));\n\nAlpine.start();\n"],"names":["Alpine","CTFd","serializeJSON","data","property","field","id","response","error","error_msg","copyToClipboard","Modal","code","url","categories","breakdown","solve","category","colorHash","embed","getUserScoreOption"],"mappings":"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"}